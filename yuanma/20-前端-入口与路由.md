# 前端：入口与路由

## 应用入口：src/main.ts
源码：[main.ts](file:///f:/C/frontend/src/main.ts#L1-L45)

- 创建应用：Vue App + Pinia + Router
- Service Worker：`virtual:pwa-register` 注册离线缓存
- 挂载前初始化（如果有 token）：
  - 拉取用户信息：`GET /auth/me`（通过 store 封装）
  - 拉取用户设置：`GET /settings/user`
  - 初始化 Socket：`initSocket(token)`

## 路由表：src/router/index.ts
源码：[index.ts](file:///f:/C/frontend/src/router/index.ts#L1-L298)

### 关键路由
- `/`：根据登录状态与 `defaultLandingPage` 重定向到 `/login`/`/match`/`/posts`/`/home`
  - 代码段：[index.ts](file:///f:/C/frontend/src/router/index.ts#L8-L23)
- 需要登录的页面：大部分 route 都 `meta.requiresAuth = true`
- 游戏房间：
  - 房间页：`/game/room/:roomId`（GameRoom）
  - 游戏页：`/game/room/:roomId/:gameType`（GamePlay）

### 全局守卫（beforeEach）
- 离开房间自动清理：从 GameRoom/GamePlay 跳走时，后台调用 `POST /rooms/leave-all`（不阻塞导航）
  - 代码段：[index.ts](file:///f:/C/frontend/src/router/index.ts#L265-L278)
- requiresAuth / requiresAdmin：未满足时跳 Home（初始加载中会放行，让页面内部处理）
  - 代码段：[index.ts](file:///f:/C/frontend/src/router/index.ts#L280-L295)

