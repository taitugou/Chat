# 积分系统功能点梳理

## 一、后端API接口

### 1. 积分相关接口
- `GET /api/user/points` - 获取积分余额
- `GET /api/user/points/records` - 获取积分记录（分页）
- `GET /api/user/points/ranking` - 获取积分排行榜

### 2. 签到相关接口
- `POST /api/settings/checkin` - 每日签到
- `GET /api/settings/checkin/status` - 获取签到状态

### 3. 任务相关接口
- `GET /api/task/tasks` - 获取任务列表
- `POST /api/task/tasks/:taskId/complete` - 完成任务
- `POST /api/task/invite/:code` - 使用邀请码
- `POST /api/task/invite/generate` - 生成邀请码
- `GET /api/task/invite/code` - 获取我的邀请码
- `GET /api/task/invite/records` - 获取邀请记录
- `POST /api/task/profile/complete` - 完善资料奖励

## 二、前端页面和组件

### 1. 页面
- `/points` - 积分中心页面
- `/checkin` - 签到页面

### 2. 组件
- Points.vue - 积分中心组件
- Checkin.vue - 签到组件

## 三、数据库表

### 1. users表字段
- `points` - 积分余额

### 2. point_records表
- `id` - 主键
- `user_id` - 用户ID
- `amount` - 积分数量
- `type` - 类型（earn/spend）
- `description` - 描述
- `created_at` - 创建时间

### 3. checkin_records表
- `id` - 主键
- `user_id` - 用户ID
- `checkin_date` - 签到日期
- `consecutive_days` - 连续签到天数
- `points_earned` - 获得积分
- `created_at` - 创建时间

### 4. task_records表
- `id` - 主键
- `user_id` - 用户ID
- `task_id` - 任务ID
- `task_type` - 任务类型
- `completed` - 是否完成
- `completed_at` - 完成时间
- `created_at` - 创建时间

### 5. invite_codes表
- `id` - 主键
- `code` - 邀请码
- `inviter_id` - 邀请人ID
- `invitee_id` - 被邀请人ID
- `used` - 是否使用
- `used_at` - 使用时间
- `created_at` - 创建时间

## 四、积分获取方式

### 1. 基础奖励
- 每日签到：+10
- 连续签到3天：+10
- 连续签到7天：+20

### 2. 内容互动奖励
- 发布帖子：+5
- 帖子获得点赞：+2
- 帖子获得评论：+3
- 帖子被转发：+4
- 被关注：+1

### 3. 任务奖励
- 发布3篇帖子：+15
- 点赞5次：+5
- 评论3次：+5
- 邀请好友：+50
- 完善资料：+20

### 4. 成就奖励
- 累计100赞：+30
- 累计50帖：+50

## 五、需要删除的文件

### 后端文件
1. `routes/settings.js` - 签到相关路由
2. `routes/task.js` - 任务相关路由
3. `utils/pointsManager.js` - 积分管理工具
4. `database/migrations/*` - 积分相关数据库迁移

### 前端文件
1. `src/views/Points.vue` - 积分中心页面
2. `src/views/Checkin.vue` - 签到页面

### 需要修改的文件
1. `routes/user.js` - 删除积分相关路由
2. `src/views/Profile.vue` - 删除积分显示

## 六、需要保留的功能

1. 用户积分字段（users.points）
2. 积分记录表（point_records）
3. 积分排行榜功能

## 七、重构计划

### 阶段1：删除旧代码
1. 删除后端积分相关路由
2. 删除前端积分相关页面
3. 删除积分管理工具

### 阶段2：创建新的积分系统
1. 创建新的积分路由（routes/points.js）
2. 创建积分控制器（controllers/pointsController.js）
3. 创建积分服务（services/pointsService.js）

### 阶段3：创建新的前端页面
1. 创建新的积分中心页面
2. 创建新的签到组件

### 阶段4：测试
1. 测试所有积分API
2. 测试前端页面
3. 测试积分获取和消耗
